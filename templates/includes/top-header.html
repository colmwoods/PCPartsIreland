{% load math_filters %}
<div class="top-header py-2">
    <div class="container">

        <div class="d-flex justify-content-between align-items-center small">

            <!-- LEFT SIDE - SEARCH -->
            <form method="GET" action="{% url 'product_search' %}" id="search-form">
                <input type="search" name="q" id="search-input" class="form-control">
                <button type="submit">
                    <i class="bi bi-search"></i>
                </button>
            </form>

            <!-- RIGHT SIDE - EXISTING LINKS -->
            <div class="d-flex align-items-center gap-3">

                <!-- Currency Dropdown -->
                <div class="dropdown">
                    <a class="top-header-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <i class="fas fa-money-bill-wave me-1"></i>
                        {{ current_currency }}
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end">
                        {% for code, data in currencies.items %}
                        <li>
                            <a class="dropdown-item" href="{% url 'set_currency' code %}">
                                {{ data.symbol }} {{ code }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <!-- Account Dropdown -->
                <div class="dropdown">
                    <a class="top-header-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        My Account
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end">
                        {% if request.user.is_authenticated %}
                        <li>
                            <a class="dropdown-item" href="{% url 'profile' %}">
                                My Profile
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'account_logout' %}">
                                Logout
                            </a>
                        </li>
                        {% else %}
                        <li>
                            <a class="dropdown-item" href="{% url 'account_signup' %}">
                                Register
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'account_login' %}">
                                Login
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Bag -->
                <a href="{% url 'view_bag' %}" class="top-header-link d-flex align-items-center gap-1">
                    <i class="bi bi-bag"></i>

                    {% if product_count %}
                    <span>Bag ({{ product_count }})</span>
                    <span>
                        {{ currency_symbol }}{{ total|mul:currency_rate|floatformat:2 }}
                    </span>
                    {% else %}
                    <span>Bag (0)</span>
                    {% endif %}
                </a>

            </div>
        </div>
    </div>
</div>